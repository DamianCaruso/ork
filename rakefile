task :default => :test

desc 'Start riak test server'
task :start do
  require File.expand_path("./test/helper", File.dirname(__FILE__))
  puts '..:: Starting riak test server ::..'
  test_server.start
  sleep 1
end

desc 'Run tests'
task :test => [:start] do
  Dir["test/*.rb"].each { |file| load file unless file =~ /helper.rb/ }
end

desc 'Stop riak test server'
task :stop => [:start] do
  puts '..:: Stop riak test server ::..'

  flush_db!
  test_server.stop
end

at_exit do
  if $server
    puts '..:: Stopping riak test server ::..'
    sleep 1

    $server.drop
    $server.stop
  end
end
